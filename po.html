<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mathematical Formulation - Inflation Tracking Optimization</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #2c3e50;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            font-size: 2.8em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }
        
        .subtitle {
            text-align: center;
            font-size: 1.3em;
            opacity: 0.8;
            margin-bottom: 40px;
            font-weight: 300;
        }
        
        .section {
            margin: 35px 0;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }
        
        .section-title {
            font-size: 1.6em;
            font-weight: 600;
            margin-bottom: 25px;
            color: #2c3e50;
        }
        
        .objective-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin: 25px 0;
            text-align: center;
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }
        
        .objective-title {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .math-block {
            font-size: 1.3em;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .vector-first-section {
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            border-left: 5px solid #ff6b6b;
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
        }
        
        .step-box {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #ff6b6b;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .step-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .math-item {
            margin: 12px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }
        
        .constraints-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .constraint-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .constraint-item.disabled {
            opacity: 0.4;
            position: relative;
        }
        
        .constraint-item.disabled::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 20px;
            right: 20px;
            height: 2px;
            background: #dc3545;
            z-index: 1;
        }
        
        .constraint-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .highlight {
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #fdcb6e;
        }
        
        .arrow {
            text-align: center;
            font-size: 2em;
            margin: 20px 0;
            color: #ff6b6b;
        }
        
        ul {
            list-style: none;
            padding-left: 0;
        }
        
        li {
            margin: 8px 0;
            padding-left: 25px;
            position: relative;
        }
        
        li:before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
        }
        
        .tips-highlight {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Mathematical Formulation</h1>        
        <!-- Decision Variable -->
        <div class="section">
            <div class="section-title">Decision Variable</div>
            <div class="math-item">
                <strong>Portfolio Weights:</strong> \(w \in \mathbb{R}^n\) = portfolio weights vector
            </div>
        </div>
        
        <!-- Objective Function -->
        <div class="objective-box">
            <div class="objective-title">Objective Function</div>
            <div class="math-block">
                $$\min \frac{1}{2} \|R_{6m} w - r_{6m}^{bench}\|_2^2 + \frac{1}{2} \|R_{12m} w - r_{12m}^{bench}\|_2^2 + \lambda \|w - w_{prev}\|_1$$
            </div>
        </div>
        
        <!-- Vector-First Construction -->
        <div class="vector-first-section">
            <div class="section-title">üìä Matrix and Vector Construction (Vector-First Approach)</div>
            
            <!-- Step 1: Raw Input Data -->
            <div class="step-box">
                <div class="step-title">Step 1: Raw Input Data</div>
                <div style="display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 250px; background: white; border-radius: 8px; padding: 15px; border: 1px solid #e9ecef; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="font-weight: bold; margin-bottom: 10px;">üìà data_bench (TIPS yields)</div>
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.8em;">
                            <tr><th style="padding: 5px; border: 1px solid #dee2e6; background: #f8f9fa;">Date</th><th style="padding: 5px; border: 1px solid #dee2e6; background: #f8f9fa;">T10YIE</th></tr>
                            <tr><td style="padding: 5px; border: 1px solid #dee2e6;">2024-01-01</td><td style="padding: 5px; border: 1px solid #dee2e6;">0.0234</td></tr>
                            <tr><td style="padding: 5px; border: 1px solid #dee2e6;">2024-01-02</td><td style="padding: 5px; border: 1px solid #dee2e6;">0.0241</td></tr>
                            <tr><td style="padding: 5px; border: 1px solid #dee2e6;">...</td><td style="padding: 5px; border: 1px solid #dee2e6;">...</td></tr>
                            <tr style="background: #e3f2fd;"><td style="padding: 5px; border: 1px solid #dee2e6;">2024-01-08</td><td style="padding: 5px; border: 1px solid #dee2e6;">0.0237</td></tr>
                            <tr style="background: #e3f2fd;"><td style="padding: 5px; border: 1px solid #dee2e6;">2024-01-09</td><td style="padding: 5px; border: 1px solid #dee2e6;">0.0245</td></tr>
                        </table>
                        <small>üìÖ 126/252 trading days needed for lookback</small>
                    </div>
                    
                    <div style="flex: 1; min-width: 250px; background: white; border-radius: 8px; padding: 15px; border: 1px solid #e9ecef; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="font-weight: bold; margin-bottom: 10px;">üìä data_tr (Stock returns)</div>
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.8em;">
                            <tr><th style="padding: 5px; border: 1px solid #dee2e6; background: #f8f9fa;">Date</th><th style="padding: 5px; border: 1px solid #dee2e6; background: #f8f9fa;">gvkey</th><th style="padding: 5px; border: 1px solid #dee2e6; background: #f8f9fa;">tr</th></tr>
                            <tr><td style="padding: 5px; border: 1px solid #dee2e6;">2024-01-08</td><td style="padding: 5px; border: 1px solid #dee2e6;">001001</td><td style="padding: 5px; border: 1px solid #dee2e6;">0.015</td></tr>
                            <tr><td style="padding: 5px; border: 1px solid #dee2e6;">2024-01-08</td><td style="padding: 5px; border: 1px solid #dee2e6;">001002</td><td style="padding: 5px; border: 1px solid #dee2e6;">0.009</td></tr>
                            <tr><td style="padding: 5px; border: 1px solid #dee2e6;">2024-01-08</td><td style="padding: 5px; border: 1px solid #dee2e6;">001003</td><td style="padding: 5px; border: 1px solid #dee2e6;">0.021</td></tr>
                        </table>
                        <small>üîç Thousands of rows, filtered by baseline</small>
                    </div>
                    
                    <div style="flex: 1; min-width: 200px; background: white; border-radius: 8px; padding: 15px; border: 1px solid #e9ecef; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="font-weight: bold; margin-bottom: 10px;">üéØ baseline (Universe filter)</div>
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.8em;">
                            <tr><th style="padding: 5px; border: 1px solid #dee2e6; background: #f8f9fa;">gvkey</th><th style="padding: 5px; border: 1px solid #dee2e6; background: #f8f9fa;">wgt</th></tr>
                            <tr><td style="padding: 5px; border: 1px solid #dee2e6;">001001</td><td style="padding: 5px; border: 1px solid #dee2e6;">0.40</td></tr>
                            <tr><td style="padding: 5px; border: 1px solid #dee2e6;">001002</td><td style="padding: 5px; border: 1px solid #dee2e6;">0.35</td></tr>
                            <tr><td style="padding: 5px; border: 1px solid #dee2e6;">001003</td><td style="padding: 5px; border: 1px solid #dee2e6;">0.25</td></tr>
                        </table>
                        <small>‚ö° Only selected stocks from data_tr</small>
                    </div>
                </div>
            </div>
            
            <div class="step-box">
                <div class="step-title">Step 2: Build Benchmark Vector FIRST (Establishes Master Calendar)</div>
                <div style="background: #f0f8ff; border: 2px solid #3498db; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4>üéØ TIPS Yield Vector Construction</h4>
                    <div class="tips-highlight">
                        üèõÔ∏è <strong>TIPS Benchmark:</strong> Treasury Inflation-Protected Securities (10-Year Breakeven Inflation Rate)
                    </div>
                    <p><strong>Input:</strong> data_bench, rebal_date=2024-01-22, lookback_days=126</p>
                    
                    <div style="margin: 20px 0;">
                        <code>lookback_dates = last 126 trading days before 2024-01-22</code>
                        <div style="text-align: center; font-size: 1.5em; color: #feca57; margin: 10px 0;">‚Üì</div>
                        <table style="margin: 10px 0; width: 100%; border-collapse: collapse;">
                            <tr style="background: #fff3cd; font-weight: bold;">
                                <th style="padding: 8px; border: 1px solid #dee2e6;">Index</th><th style="padding: 8px; border: 1px solid #dee2e6;">Date</th><th style="padding: 8px; border: 1px solid #dee2e6;">TIPS Yield</th>
                            </tr>
                            <tr><td style="padding: 8px; border: 1px solid #dee2e6;">[0]</td><td style="padding: 8px; border: 1px solid #dee2e6;">2024-01-08</td><td style="padding: 8px; border: 1px solid #dee2e6;">0.0237</td></tr>
                            <tr><td style="padding: 8px; border: 1px solid #dee2e6;">[1]</td><td style="padding: 8px; border: 1px solid #dee2e6;">2024-01-09</td><td style="padding: 8px; border: 1px solid #dee2e6;">0.0245</td></tr>
                            <tr><td style="padding: 8px; border: 1px solid #dee2e6;">[2]</td><td style="padding: 8px; border: 1px solid #dee2e6;">2024-01-10</td><td style="padding: 8px; border: 1px solid #dee2e6;">0.0239</td></tr>
                            <tr><td style="padding: 8px; border: 1px solid #dee2e6;">...</td><td style="padding: 8px; border: 1px solid #dee2e6;">...</td><td style="padding: 8px; border: 1px solid #dee2e6;">...</td></tr>
                            <tr><td style="padding: 8px; border: 1px solid #dee2e6;">[125]</td><td style="padding: 8px; border: 1px solid #dee2e6;">2024-01-22</td><td style="padding: 8px; border: 1px solid #dee2e6;">0.0241</td></tr>
                        </table>
                    </div>
                    
                    <p><strong>‚ú® Output:</strong></p>
                    <li>\(r_{6m}^{bench} \in \mathbb{R}^{126}\) = Last 126 trading days of TIPS yields before rebalance date</li>
                    <li>\(r_{12m}^{bench} \in \mathbb{R}^{252}\) = Last 252 trading days of TIPS yields before rebalance date</li>
                </div>
            </div>
            
            <div style="text-align: center; font-size: 2em; margin: 20px 0; color: #e67e22;">‚¨áÔ∏è CRITICAL: Vector establishes the "Master Calendar"</div>
            
            <div class="step-box">
                <div class="step-title">Step 3: Build Stock Matrix Using Same Dates (Forced Alignment)</div>
                <div style="background: #fef9e7; border: 2px solid #f39c12; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4>üìä Stock Return Matrix Construction</h4>
                    <p><strong>Input:</strong> data_tr, baseline, required_dates (from TIPS vector!)</p>
                    
                    <div style="margin: 20px 0;">
                        <p><strong>1. Filter universe:</strong> baseline selects only 3 stocks from available data_tr</p>
                        <p><strong>2. Initialize matrix:</strong> (126 dates √ó 3 stocks) filled with zeros</p>
                        <p><strong>3. Fill column by column using EXACT same dates as TIPS vector:</strong></p>
                        
                        <table style="margin: 20px 0; width: 100%; border-collapse: collapse;">
                            <tr style="background: #fff3cd; font-weight: bold;">
                                <th style="padding: 8px; border: 1px solid #dee2e6;">Date</th><th style="padding: 8px; border: 1px solid #dee2e6;">001001 (Stock A)</th><th style="padding: 8px; border: 1px solid #dee2e6;">001002 (Stock B)</th><th style="padding: 8px; border: 1px solid #dee2e6;">001003 (Stock C)</th>
                            </tr>
                            <tr><td style="padding: 8px; border: 1px solid #dee2e6;">2024-01-08</td><td style="padding: 8px; border: 1px solid #dee2e6;">0.015</td><td style="padding: 8px; border: 1px solid #dee2e6;">0.009</td><td style="padding: 8px; border: 1px solid #dee2e6;">0.021</td></tr>
                            <tr><td style="padding: 8px; border: 1px solid #dee2e6;">2024-01-09</td><td style="padding: 8px; border: 1px solid #dee2e6;">-0.012</td><td style="padding: 8px; border: 1px solid #dee2e6;">0.018</td><td style="padding: 8px; border: 1px solid #dee2e6;">0.005</td></tr>
                            <tr><td style="padding: 8px; border: 1px solid #dee2e6;">2024-01-10</td><td style="padding: 8px; border: 1px solid #dee2e6;">0.008</td><td style="padding: 8px; border: 1px solid #dee2e6;">-0.003</td><td style="padding: 8px; border: 1px solid #dee2e6; background: #f8d7da; color: #721c24; font-weight: bold;">0.000</td></tr>
                            <tr><td style="padding: 8px; border: 1px solid #dee2e6;">...</td><td style="padding: 8px; border: 1px solid #dee2e6;">...</td><td style="padding: 8px; border: 1px solid #dee2e6;">...</td><td style="padding: 8px; border: 1px solid #dee2e6;">...</td></tr>
                            <tr><td style="padding: 8px; border: 1px solid #dee2e6;">2024-01-22</td><td style="padding: 8px; border: 1px solid #dee2e6;">0.006</td><td style="padding: 8px; border: 1px solid #dee2e6;">0.016</td><td style="padding: 8px; border: 1px solid #dee2e6;">0.012</td></tr>
                        </table>
                    </div>
                    
                    <li>\(R_{6m} \in \mathbb{R}^{126 \times n}\) = Stock returns matrix using exact same 126 dates as benchmark vector</li>
                    <li>\(R_{12m} \in \mathbb{R}^{252 \times n}\) = Stock returns matrix using exact same 252 dates as benchmark vector</li>
                    <li>Missing stock data on any date ‚Üí filled with zeros</li>
                    <li>Only stocks in baseline universe included (filtered from larger data_tr)</li>
                </div>
            </div>
            
            <div class="step-box">
                <div class="step-title">Step 4: Perfect Alignment Guaranteed</div>
                <div class="highlight">
                    <li>Row \(i\) of \(R_{6m}\) corresponds to element \(i\) of \(r_{6m}^{bench}\) (same trading date)</li>
                    <li>Row \(i\) of \(R_{12m}\) corresponds to element \(i\) of \(r_{12m}^{bench}\) (same trading date)</li>
                    
                    <div style="margin: 20px 0; text-align: center;">
                        <div style="display: flex; gap: 30px; align-items: center; flex-wrap: wrap; justify-content: center;">
                            <div style="flex: 1; min-width: 150px;">
                                <h4>TIPS Vector (126,)</h4>
                                <div style="background: rgba(78, 205, 196, 0.3); padding: 15px; border-radius: 8px;">
                                    <div>[0] ‚Üí 0.0237</div>
                                    <div>[1] ‚Üí 0.0245</div>
                                    <div>[2] ‚Üí 0.0239</div>
                                    <div>...</div>
                                    <div>[125] ‚Üí 0.0241</div>
                                </div>
                            </div>
                            
                            <div style="font-size: 2em; color: #feca57;">√ó</div>
                            
                            <div style="flex: 1; min-width: 200px;">
                                <h4>Stock Matrix (126, 3)</h4>
                                <div style="background: rgba(255, 107, 107, 0.3); padding: 15px; border-radius: 8px;">
                                    <div>Row [0] ‚Üí [0.015, 0.009, 0.021]</div>
                                    <div>Row [1] ‚Üí [-0.012, 0.018, 0.005]</div>
                                    <div>Row [2] ‚Üí [0.008, -0.003, 0.000]</div>
                                    <div>...</div>
                                    <div>Row [125] ‚Üí [0.006, 0.016, 0.012]</div>
                                </div>
                            </div>
                            
                            <div style="font-size: 2em; color: #feca57;">@</div>
                            
                            <div style="flex: 1; min-width: 100px;">
                                <h4>Weights (3,)</h4>
                                <div style="background: rgba(254, 202, 87, 0.3); padding: 15px; border-radius: 8px;">
                                    <div>w‚ÇÅ</div>
                                    <div>w‚ÇÇ</div>
                                    <div>w‚ÇÉ</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Parameters -->
        <div class="section">
            <div class="section-title">Parameters</div>
            <div class="math-item">
                <li>\(\lambda\) = turnover penalty parameter</li>
                <li>\(w_{prev}\) = previous period weights</li>
            </div>
        </div>
        
        <!-- Constraints -->
        <div class="section">
            <div class="section-title">Constraints</div>
            <div class="constraints-grid">
                <div class="constraint-item">
                    <div class="constraint-title">1. Fully Invested</div>
                    $$\sum_{i=1}^n w_i = 1$$
                </div>
                
                <div class="constraint-item">
                    <div class="constraint-title">2. Long-Only</div>
                    $$w_i \geq w_{min} \quad \forall i$$
                </div>
                
                <div class="constraint-item">
                    <div class="constraint-title">3. Position Limits</div>
                    $$w_i \leq w_{max} \quad \forall i$$
                </div>
                
                <div class="constraint-item">
                    <div class="constraint-title">4. Baseline Multiplier Bounds</div>
                    $$\ell_i \cdot w_i^{base} \leq w_i \leq u_i \cdot w_i^{base} \quad \forall i$$
                </div>
                
                <div class="constraint-item disabled">
                    <div class="constraint-title">5. Portfolio Beta Constraints</div>
                    $$\beta_L \leq \sum_{i=1}^n \beta_i w_i \leq \beta_U$$
                    <small style="color: #dc3545; font-weight: bold;">(DISABLED: beta_bounds = None)</small>
                </div>
                
                <div class="constraint-item disabled">
                    <div class="constraint-title">6. Sector Allocation</div>
                    $$\left|\sum_{i \in S} w_i - \theta_S\right| \leq \delta \theta_S \quad \forall \text{ sectors } S$$
                    <small style="color: #dc3545; font-weight: bold;">(DISABLED: sect_max_diff = None)</small>
                </div>
                
                <div class="constraint-item">
                    <div class="constraint-title">7. Turnover Constraint</div>
                    $$\|w - w_{prev}\|_1 \leq T_{cap}$$
                    <small>(if enabled)</small>
                </div>
            </div>
        </div>
        
        <div class="highlight">
            <strong>üéØ Key Innovation:</strong> The vector-first approach ensures that benchmark vectors establish the "master calendar" of trading dates, forcing stock matrices to align perfectly. This guarantees robust optimization across changing stock universes and missing data scenarios.
        </div>
        
        <!-- Solution Method -->
        <div class="section">
            <div class="section-title">Solution Method</div>
            <div class="math-item">
                <strong>Convex Quadratic Programming (QP):</strong>
                <li>Solver: ECOS (primary), OSQP, SCS, CLARABEL (fallback)</li>
                <li>Tolerance: feastol = 1e-3, abstol = 1e-3, reltol = 1e-3</li>
                <li>Max iterations: 100,000</li>
                <li>Warm start: Disabled for stability</li>
            </div>
        </div>
        
        <!-- Turnover Management -->
        <div class="section">
            <div class="section-title">Adaptive Turnover Management</div>
            <div class="math-item">
                <strong>Dynamic Turnover Cap:</strong>
                <li>Initial cap: 5%</li>
                <li>Step size: 2.5%</li>
                <li>Maximum cap: 200%</li>
                <li>Strategy: Start conservative, relax constraints if infeasible</li>
            </div>
            
            <div style="background: #e8f4fd; border: 2px solid #2196f3; padding: 20px; border-radius: 10px; margin: 20px 0;">
                <h4>üîÑ Turnover Algorithm Flow:</h4>
                <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap; justify-content: center; margin: 15px 0;">
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6; text-align: center; min-width: 120px;">
                        <strong>Start:</strong><br>
                        TO cap = 5%
                    </div>
                    <div style="font-size: 1.5em; color: #2196f3;">‚Üí</div>
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6; text-align: center; min-width: 120px;">
                        <strong>Solve QP</strong><br>
                        with constraint
                    </div>
                    <div style="font-size: 1.5em; color: #2196f3;">‚Üí</div>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border: 1px solid #ffc107; text-align: center; min-width: 120px;">
                        <strong>Feasible?</strong><br>
                        Check status
                    </div>
                </div>
                
                <div style="display: flex; gap: 20px; justify-content: center; margin: 20px 0;">
                    <div style="text-align: center;">
                        <div style="background: #d4edda; color: #155724; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                            ‚úÖ <strong>YES</strong>
                        </div>
                        <div>Accept solution<br>Store turnover</div>
                    </div>
                    
                    <div style="text-align: center;">
                        <div style="background: #f8d7da; color: #721c24; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                            ‚ùå <strong>NO</strong>
                        </div>
                        <div>Increase cap by 2.5%<br>Retry (up to 200%)</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Risk Management -->
        <div class="section">
            <div class="section-title">Risk Management Framework</div>
            
            <div class="constraints-grid">
                <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #28a745; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
                    <div style="font-weight: 600; margin-bottom: 10px; color: #2c3e50;">Position Risk Controls</div>
                    <li>Min weight: 1e-5 (effectively zero)</li>
                    <li>Max weight: 7% (concentration limit)</li>
                    <li>Baseline multipliers: 0.6√ó to 1.4√ó</li>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #ffc107; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
                    <div style="font-weight: 600; margin-bottom: 10px; color: #2c3e50;">Quality Filters</div>
                    <li>GRR (Geographic Risk Rating) ‚â• 1.5</li>
                    <li>Quarterly rebalancing (Jan, Apr, Jul, Oct)</li>
                    <li>Last trading day of each quarter</li>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #dc3545; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
                    <div style="font-weight: 600; margin-bottom: 10px; color: #2c3e50;">Transaction Cost Management</div>
                    <li>Turnover penalty: Œª = 1e-4</li>
                    <li>L1 norm penalty on weight changes</li>
                    <li>Adaptive constraint relaxation</li>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #6f42c1; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
                    <div style="font-weight: 600; margin-bottom: 10px; color: #2c3e50;">Data Integrity</div>
                    <li>Missing data ‚Üí zero fill</li>
                    <li>Negative weights ‚Üí clamp to zero</li>
                    <li>Weight sum validation (= 1.0)</li>
                </div>
            </div>
        </div>
        
        <!-- Performance Tracking -->
        <div class="section">
            <div class="section-title">Performance Attribution</div>
            
            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 12px; margin: 20px 0;">
                <h4 style="margin-bottom: 15px;">üìä Rolling Metrics Calculation</h4>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                    <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px;">
                        <strong>Rolling Alpha (60-day)</strong><br>
                        <code style="font-size: 0.9em;">Œ± = (1 + excess_return)^(252/60) - 1</code>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px;">
                        <strong>Rolling Beta</strong><br>
                        <code style="font-size: 0.9em;">Œ≤ = Cov(r_p, r_b) / Var(r_b)</code>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px;">
                        <strong>Tracking Error</strong><br>
                        <code style="font-size: 0.9em;">TE = Std(r_p - r_b) √ó ‚àö252</code>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px;">
                        <strong>Sector Weights</strong><br>
                        <code style="font-size: 0.9em;">w_s = Œ£ w_i for i ‚àà sector s</code>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Strategy Parameters -->
        <div class="section">
            <div class="section-title">‚öôÔ∏è Strategy Parameters</div>
            
            <div class="constraints-grid">
                <div class="constraint-item">
                    <div class="constraint-title">üìÖ Rebalancing</div>
                    <li><strong>Months:</strong> [1, 4, 7, 10] (Quarterly)</li>
                    <li><strong>Timing:</strong> Last trading day</li>
                </div>
                
                <div class="constraint-item">
                    <div class="constraint-title">üîÑ Turnover</div>
                    <li><strong>Initial cap:</strong> 5%</li>
                    <li><strong>Max limit:</strong> 200%</li>
                    <li><strong>Step:</strong> 2.5%</li>
                    <li><strong>Penalty (Œª):</strong> 1e-4</li>
                </div>
                
                <div class="constraint-item">
                    <div class="constraint-title">‚öñÔ∏è Position Limits</div>
                    <li><strong>Min weight:</strong> 1e-5</li>
                    <li><strong>Max weight:</strong> 7%</li>
                    <li><strong>Multiplier bounds:</strong> (0.6, 1.4)</li>
                </div>
                
                <div class="constraint-item">
                    <div class="constraint-title">üéØ Solver</div>
                    <li><strong>Primary:</strong> ECOS</li>
                    <li><strong>Tolerances:</strong> 1e-3</li>
                    <li><strong>Max iters:</strong> 100k</li>
                </div>
                
                <div class="constraint-item disabled">
                    <div class="constraint-title">üö´ Disabled</div>
                    <li><strong>Beta bounds:</strong> None</li>
                    <li><strong>Sector bands:</strong> None</li>
                    <li><strong>Warm start:</strong> False</li>
                </div>
            </div>
        </div>

        <!-- Performance Results -->
        <div class="section">
            <div class="section-title">üìà Performance Analysis</div>
            
            <!-- Performance Charts -->
            <div style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0; border: 1px solid #dee2e6;">
                <h5 style="margin-bottom: 15px; color: #2c3e50; text-align: center;">Rolling Performance Metrics</h5>
                <img src="performance_dashboard.png" alt="Rolling Performance Metrics Dashboard" style="width: 100%; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                <p style="text-align: center; margin-top: 10px; color: #6c757d; font-size: 0.9em;">
                    Beta spikes during crises, tracking error well-controlled, turnover managed at 5%
                </p>
            </div>
            
            <div style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0; border: 1px solid #dee2e6;">
                <h5 style="margin-bottom: 15px; color: #2c3e50; text-align: center;">Sector Weight Evolution</h5>
                <img src="sector_evolution.png" alt="Sector Weight Evolution Chart" style="width: 100%; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                <p style="text-align: center; margin-top: 10px; color: #6c757d; font-size: 0.9em;">
                    Health Care ‚Üó (15%‚Üí25%), Energy ‚Üò (12%‚Üí4%), Tech stable (~10%)
                </p>
            </div>
            
            <!-- Key Insights -->
            <div style="background: #e8f4fd; border-left: 5px solid #2196f3; padding: 20px; border-radius: 8px; margin: 20px 0;">
                <h4 style="color: #1976d2; margin-bottom: 15px;">üéØ Key Performance Insights</h4>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        <h6 style="color: #28a745; margin-bottom: 8px;">‚úÖ Tracking Success</h6>
                        <li>Error mostly < 0.2</li>
                        <li>Dual-horizon (6m+12m) works</li>
                        <li>TIPS inflation hedging effective</li>
                    </div>
                    
                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        <h6 style="color: #ffc107; margin-bottom: 8px;">‚ö†Ô∏è Beta Volatility</h6>
                        <li>Spikes to 4+ in crises</li>
                        <li>No beta constraints enabled</li>
                        <li>High systematic risk exposure</li>
                    </div>
                    
                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        <h6 style="color: #007bff; margin-bottom: 8px;">üîÑ Sector Rotation</h6>
                        <li>Health Care: inflation winner</li>
                        <li>Energy: declining despite hedge properties</li>
                        <li>Strategy favors stable correlations</li>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Implementation Notes -->
        <div class="section">
            <div class="section-title">Key Implementation Features</div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 25px 0;">
                <div style="background: #f8f9fa; border: 2px solid #28a745; padding: 20px; border-radius: 10px;">
                    <h4 style="color: #28a745; margin-bottom: 15px;">üöÄ Robust Matrix Construction</h4>
                    <li>Vector-first approach prevents date misalignment</li>
                    <li>Handles missing data gracefully (zero-fill)</li>
                    <li>Supports changing stock universes</li>
                    <li>Maintains chronological consistency</li>
                </div>
                
                <div style="background: #f8f9fa; border: 2px solid #007bff; padding: 20px; border-radius: 10px;">
                    <h4 style="color: #007bff; margin-bottom: 15px;">‚ö° Adaptive Solver Strategy</h4>
                    <li>Multiple solver fallbacks (ECOS ‚Üí OSQP ‚Üí SCS)</li>
                    <li>Dynamic constraint relaxation</li>
                    <li>Convergence monitoring and validation</li>
                    <li>Numerical stability checks</li>
                </div>
                
                <div style="background: #f8f9fa; border: 2px solid #ffc107; padding: 20px; border-radius: 10px;">
                    <h4 style="color: #e67e00; margin-bottom: 15px;">üéØ TIPS Inflation Hedging</h4>
                    <li>Direct tracking of Treasury breakeven inflation</li>
                    <li>Dual-horizon optimization (6m + 12m)</li>
                    <li>Equal weighting of short and long-term tracking</li>
                    <li>Sector rotation based on inflation sensitivity</li>
                </div>
                
                <div style="background: #f8f9fa; border: 2px solid #dc3545; padding: 20px; border-radius: 10px;">
                    <h4 style="color: #dc3545; margin-bottom: 15px;">üõ°Ô∏è Risk & Cost Management</h4>
                    <li>Concentration limits (max 7% per position)</li>
                    <li>Quality screening (GRR ‚â• 1.5)</li>
                    <li>Transaction cost optimization via turnover penalty</li>
                    <li>Portfolio rebalancing validation</li>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div style="text-align: center; margin-top: 40px; padding: 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 12px;">
            <h3 style="margin-bottom: 10px;">üéØ Inflation-Tracking Portfolio Optimization</h3>
            <p style="margin: 0; opacity: 0.9;">A sophisticated quantitative strategy for hedging inflation risk through equity portfolio construction</p>
        </div>
    </div>
</body>
</html>
