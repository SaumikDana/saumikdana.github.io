<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HMM Framework Explainer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }
        
        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section h3 {
            color: #34495e;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        .step {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .step-number {
            display: inline-block;
            width: 35px;
            height: 35px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .formula {
            background: #e8eaf6;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            border-left: 4px solid #5c6bc0;
        }
        
        .example {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        
        .code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .keyword {
            color: #ff79c6;
        }
        
        .function {
            color: #50fa7b;
        }
        
        .comment {
            color: #6272a4;
        }
        
        .highlight {
            background: #fff9c4;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: 600;
        }
        
        .warning {
            background: #ffebee;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #f44336;
            margin: 15px 0;
        }
        
        .success {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #4caf50;
            margin: 15px 0;
        }
        
        ul, ol {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        li {
            margin: 8px 0;
        }
        
        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .flow-box {
            background: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 2px solid #667eea;
            min-width: 150px;
            text-align: center;
        }
        
        .arrow {
            font-size: 2em;
            color: #667eea;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: #667eea;
            color: white;
        }
        
        tr:hover {
            background: #f5f5f5;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ Hidden Markov Model (HMM) Framework</h1>
            <p>Understanding Regime Detection with Expectation-Maximization</p>
        </header>
        
        <div class="content">
            <!-- OVERVIEW -->
            <div class="section">
                <h2>üìã Overview</h2>
                <p><strong>Goal:</strong> Detect different "regimes" (states) in a time series where each regime has different statistical properties.</p>
                
                <div class="example">
                    <strong>Example:</strong> Model accuracy time series might have:
                    <ul>
                        <li><strong>HIGH regime:</strong> Mean accuracy ‚âà 0.83</li>
                        <li><strong>MED regime:</strong> Mean accuracy ‚âà 0.65</li>
                        <li><strong>LOW regime:</strong> Mean accuracy ‚âà 0.46</li>
                    </ul>
                </div>
                
                <p>The challenge: We <strong>don't observe</strong> which regime each time point belongs to - it's "hidden"! We only see the accuracy values.</p>
            </div>
            
            <!-- THE PROBLEM -->
            <div class="section">
                <h2>‚ùì The Problem Setup</h2>
                
                <h3>What We Have:</h3>
                <ul>
                    <li>Time series of values: <code>[0.82, 0.85, 0.83, 0.45, 0.48, 0.44, 0.81, 0.84, ...]</code></li>
                    <li>We want to find <strong>n regimes</strong> (e.g., n=3 for HIGH, MED, LOW)</li>
                </ul>
                
                <h3>What We Need to Learn:</h3>
                <table>
                    <tr>
                        <th>Parameter</th>
                        <th>Meaning</th>
                    </tr>
                    <tr>
                        <td><strong>Œº (mu)</strong></td>
                        <td>Mean value for each regime</td>
                    </tr>
                    <tr>
                        <td><strong>œÉ¬≤ (sigma¬≤)</strong></td>
                        <td>Variance for each regime (how spread out)</td>
                    </tr>
                    <tr>
                        <td><strong>Transitions</strong></td>
                        <td>Probability of switching from one regime to another</td>
                    </tr>
                </table>
            </div>
            
            <!-- EM ALGORITHM -->
            <div class="section">
                <h2>üîÑ The EM Algorithm (How It Works)</h2>
                
                <div class="flow-diagram">
                    <div class="flow-box">1Ô∏è‚É£ INITIALIZE<br/>(Random)</div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box">2Ô∏è‚É£ E-STEP<br/>(Calculate Probs)</div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box">3Ô∏è‚É£ M-STEP<br/>(Update Params)</div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box">4Ô∏è‚É£ REPEAT<br/>(Until Converge)</div>
                </div>
                
                <h3>Step 1: Initialization</h3>
                <div class="step">
                    <p><span class="step-number">1</span> Start with <strong>random guesses</strong> for all parameters:</p>
                    <ul>
                        <li>Random Œº for each regime (e.g., Œº_HIGH = 0.75, Œº_MED = 0.60, Œº_LOW = 0.50)</li>
                        <li>Random œÉ¬≤ for each regime</li>
                        <li>Random transition probabilities</li>
                    </ul>
                    
                    <div class="code">
<span class="keyword">model</span> = hmm.<span class="function">GaussianHMM</span>(
    n_components=<span class="highlight">3</span>,  <span class="comment"># 3 regimes</span>
    random_state=<span class="highlight">42</span>   <span class="comment"># Reproducible random init</span>
)</div>
                </div>
                
                <h3>Step 2: E-Step (Expectation)</h3>
                <div class="step">
                    <p><span class="step-number">2</span> <strong>Calculate probabilities</strong> that each value belongs to each regime:</p>
                    
                    <div class="formula">
P(value | regime) = (1 / ‚àö(2œÄœÉ¬≤)) √ó exp(-(value - Œº)¬≤ / (2œÉ¬≤))
                    </div>
                    
                    <div class="example">
                        <strong>Example:</strong> For value = 0.82
                        <ul>
                            <li>P(0.82 | HIGH with Œº=0.80, œÉ¬≤=0.01) = 3.90 (close to mean ‚Üí high!)</li>
                            <li>P(0.82 | MED with Œº=0.65, œÉ¬≤=0.02) = 1.38 (medium distance)</li>
                            <li>P(0.82 | LOW with Œº=0.45, œÉ¬≤=0.01) = 0.004 (far from mean ‚Üí low!)</li>
                        </ul>
                        
                        <strong>Normalize:</strong> Total = 3.90 + 1.38 + 0.004 = 5.28
                        <ul>
                            <li>P(HIGH | 0.82) = 3.90 / 5.28 = <strong>74%</strong></li>
                            <li>P(MED | 0.82) = 1.38 / 5.28 = <strong>26%</strong></li>
                            <li>P(LOW | 0.82) = 0.004 / 5.28 = <strong>0.1%</strong></li>
                        </ul>
                    </div>
                    
                    <p>Do this for <strong>every value</strong> in the time series!</p>
                </div>
                
                <h3>Step 3: M-Step (Maximization)</h3>
                <div class="step">
                    <p><span class="step-number">3</span> <strong>Update parameters</strong> using the probabilities from E-step:</p>
                    
                    <div class="formula">
Œº_HIGH = Œ£(value √ó P(HIGH|value)) / Œ£(P(HIGH|value))
                    </div>
                    
                    <div class="example">
                        <strong>Example:</strong> Update Œº_HIGH using 5 values:
                        <pre>
Time 0 (0.82): 40% HIGH ‚Üí contributes 0.82 √ó 0.40 = 0.328
Time 1 (0.85): 50% HIGH ‚Üí contributes 0.85 √ó 0.50 = 0.425
Time 2 (0.45): 10% HIGH ‚Üí contributes 0.45 √ó 0.10 = 0.045
Time 3 (0.48): 20% HIGH ‚Üí contributes 0.48 √ó 0.20 = 0.096
Time 4 (0.81): 60% HIGH ‚Üí contributes 0.81 √ó 0.60 = 0.486

Œº_HIGH = (0.328 + 0.425 + 0.045 + 0.096 + 0.486) / (0.40 + 0.50 + 0.10 + 0.20 + 0.60)
       = 1.38 / 1.80 = <strong>0.767</strong>
                        </pre>
                    </div>
                    
                    <p>Similarly update œÉ¬≤ and transition probabilities.</p>
                </div>
                
                <h3>Step 4: Repeat Until Convergence</h3>
                <div class="step">
                    <p><span class="step-number">4</span> Go back to E-step with the new parameters and repeat:</p>
                    
                    <ul>
                        <li><strong>Early iterations:</strong> Big changes in probabilities</li>
                        <li><strong>Later iterations:</strong> Smaller and smaller changes</li>
                        <li><strong>Convergence:</strong> Probabilities stabilize (barely change)</li>
                    </ul>
                    
                    <div class="success">
                        ‚úÖ After ~100 iterations (or convergence), you have:
                        <ul>
                            <li>Final stable Œº, œÉ¬≤ for each regime</li>
                            <li>Final transition probabilities</li>
                            <li>Sharp probability assignments like: Time 0 is 98% HIGH, Time 3 is 95% LOW</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- MODEL SELECTION -->
            <div class="section">
                <h2>üìä Model Selection with BIC</h2>
                
                <p>How do we know if 3 regimes is better than 2 or 4? Use <strong>BIC (Bayesian Information Criterion)</strong>!</p>
                
                <div class="formula">
BIC = -2 √ó log_likelihood + n_params √ó log(n_samples)
                </div>
                
                <h3>Two Parts:</h3>
                <table>
                    <tr>
                        <th>Part</th>
                        <th>What It Measures</th>
                        <th>Effect</th>
                    </tr>
                    <tr>
                        <td><strong>-2 √ó log_likelihood</strong></td>
                        <td>How well model fits data</td>
                        <td>Lower = better fit (good!)</td>
                    </tr>
                    <tr>
                        <td><strong>n_params √ó log(n_samples)</strong></td>
                        <td>Model complexity</td>
                        <td>More params = higher penalty (bad!)</td>
                    </tr>
                </table>
                
                <div class="example">
                    <strong>Example:</strong> Compare different n values
                    <ul>
                        <li>n=2: BIC=150 (underfits, too simple)</li>
                        <li>n=3: BIC=124 ‚úÖ <strong>BEST!</strong> (good balance)</li>
                        <li>n=4: BIC=135 (overfits, too complex)</li>
                        <li>n=5: BIC=148 (definitely overfitting)</li>
                    </ul>
                    Pick <strong>n=3</strong> (lowest BIC)
                </div>
            </div>
            
            <!-- VALIDATION -->
            <div class="section">
                <h2>‚úÖ Validation Checks</h2>
                
                <p>Even with good BIC, the solution might be garbage! Check:</p>
                
                <h3>Check 1: Too Many Regime Switches?</h3>
                <div class="step">
                    <p>If regimes switch more than 10% of the time ‚Üí <strong>INVALID</strong></p>
                    
                    <div class="warning">
                        ‚ùå <strong>Bad:</strong> 100 time points with 50 switches = model is just chasing noise!
                    </div>
                    
                    <div class="success">
                        ‚úÖ <strong>Good:</strong> 100 time points with 5 switches = stable regimes
                    </div>
                </div>
                
                <h3>Check 2: Are Regimes Distinct?</h3>
                <div class="step">
                    <p>If two regime means are closer than 0.05 ‚Üí <strong>INVALID</strong></p>
                    
                    <div class="warning">
                        ‚ùå <strong>Bad:</strong> Œº_HIGH = 0.820, Œº_MED = 0.825 (only 0.005 apart!)
                        <br/>These are basically the same regime!
                    </div>
                    
                    <div class="success">
                        ‚úÖ <strong>Good:</strong> Œº_HIGH = 0.83, Œº_MED = 0.65, Œº_LOW = 0.46 (well separated)
                    </div>
                </div>
            </div>
            
            <!-- CODE MAPPING -->
            <div class="section">
                <h2>üíª Code Mapping</h2>
                
                <h3>Where Each Step Happens:</h3>
                
                <div class="step">
                    <h4>üîπ Initialization (Random Start)</h4>
                    <div class="code">
model = hmm.<span class="function">GaussianHMM</span>(n_components=n, random_state=42)
<span class="comment"># Creates model with random Œº, œÉ¬≤, transitions</span>
                    </div>
                </div>
                
                <div class="step">
                    <h4>üîπ EM Loop (E-step + M-step repeated)</h4>
                    <div class="code">
model.<span class="function">fit</span>(accuracies)
<span class="comment"># *** THIS IS WHERE THE ENTIRE EM ALGORITHM RUNS ***</span>
<span class="comment"># Internally alternates E-step and M-step until convergence</span>
                    </div>
                </div>
                
                <div class="step">
                    <h4>üîπ Calculate BIC</h4>
                    <div class="code">
log_likelihood = model.<span class="function">score</span>(accuracies) * <span class="function">len</span>(accuracies)
n_params = n**2 + 2*n
bic = -2 * log_likelihood + n_params * np.<span class="function">log</span>(<span class="function">len</span>(accuracies))
                    </div>
                </div>
                
                <div class="step">
                    <h4>üîπ Detect Regimes (After Fitting)</h4>
                    <div class="code">
regime_probs = model.<span class="function">predict_proba</span>(accuracies)
<span class="comment"># Uses fitted Œº, œÉ¬≤ to calculate P(regime | value)</span>
<span class="comment"># Returns: [[0.95, 0.03, 0.02], [0.97, 0.02, 0.01], ...]</span>

regimes = np.<span class="function">argmax</span>(regime_probs, axis=1)
<span class="comment"># Convert to hard labels: [0, 0, 2, 2, ...]</span>
                    </div>
                </div>
            </div>
            
            <!-- SUMMARY -->
            <div class="section">
                <h2>üéØ Summary</h2>
                
                <div class="flow-diagram">
                    <div class="flow-box" style="background: #e3f2fd;">
                        <strong>Start</strong><br/>
                        Time Series
                    </div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box" style="background: #f3e5f5;">
                        <strong>For n=2,3,4,5,6</strong><br/>
                        Random Init
                    </div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box" style="background: #fff3e0;">
                        <strong>EM Loop</strong><br/>
                        E-step + M-step
                    </div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box" style="background: #e8f5e9;">
                        <strong>Validate</strong><br/>
                        Check switches & distinctness
                    </div>
                    <span class="arrow">‚Üí</span>
                    <div class="flow-box" style="background: #c8e6c9;">
                        <strong>Select Best</strong><br/>
                        Lowest BIC (valid)
                    </div>
                </div>
                
                <div class="success">
                    <strong>Key Takeaways:</strong>
                    <ul>
                        <li>HMM learns <span class="highlight">hidden regime structure</span> from data</li>
                        <li>EM algorithm alternates between <span class="highlight">E-step (calculate probs)</span> and <span class="highlight">M-step (update params)</span></li>
                        <li>BIC helps choose the <span class="highlight">right number of regimes</span></li>
                        <li>Validation ensures solutions are <span class="highlight">meaningful, not garbage</span></li>
                        <li>Final model can <span class="highlight">classify new data</span> into regimes</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</body>
</html>