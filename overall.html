<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataFrame Excellence in Options Strategy Framework</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .section h3 {
            color: #34495e;
            font-size: 1.4rem;
            margin: 25px 0 15px 0;
            position: relative;
        }

        .section h4 {
            color: #4a5568;
            font-size: 1.1rem;
            margin: 15px 0 10px 0;
            font-weight: 600;
        }

        .code-block {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            border-left: 4px solid #667eea;
        }

        .inline-code {
            background: #f7fafc;
            color: #2d3748;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            border: 1px solid #e2e8f0;
        }

        .analysis-box {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .analysis-title {
            font-weight: 600;
            color: #155724;
            margin-bottom: 5px;
        }

        .highlight-box {
            background: linear-gradient(135deg, #667eea20, #764ba220);
            border: 1px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin: 20px 0;
        }

        .pattern-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }

        .pattern-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .pattern-title {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .summary-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .summary-number {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
        }

        ul, ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .pattern-grid, .summary-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .code-block {
                font-size: 0.8rem;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>DataFrame Excellence in Options Strategy Framework</h1>
            <p>Advanced pandas patterns for systematic options trading</p>
        </div>

        <div class="section">
            <h2>Architecture</h2>
            
            <h3>Multi-DataFrame Coordination System</h3>
            <div class="code-block"># Elegant dictionary-of-DataFrames pattern
dict_options = {}
for o in dict_opt_specs.keys():
    opt = df[underlying].to_frame().loc[first_date:last_date].copy()
    opt = opt.merge(df[[underlying + 'tr']], left_index=True, right_index=True, how='left')
    dict_options[o] = opt</div>
            
            <div class="analysis-box">
                <div class="analysis-title">Analysis:</div>
                This creates a coordinated system where each option leg has its own DataFrame but shares a common time index. The <span class="inline-code">.copy()</span> ensures data isolation while maintaining referential integrity.
            </div>

            <h3>Advanced Merging Strategies</h3>
            
            <h4>1. Self-Joining with Temporal Shifts</h4>
            <div class="code-block">opt['new_sym'] = opt['sym'].shift(-1)
opt = merge_with_chain(opt, options, 'new_sym')</div>
            
            <div class="analysis-box">
                <div class="analysis-title">Pandas Excellence:</div>
                Uses <span class="inline-code">shift(-1)</span> to create forward-looking contract mappings, then merges with options chain data to get "next contract" pricing. This handles expiration rollovers elegantly.
            </div>

            <h4>2. Multi-Column Merge with Column Standardization</h4>
            <div class="code-block">old_cols = ['bid_x', 'bid_y', 'ask_x', 'ask_y', 'delta_x', 'delta_y']
new_cols = ['bid', 'new_bid', 'ask', 'new_ask', 'delta', 'new_delta']
opt.rename(columns=dict(zip(old_cols, new_cols)), inplace=True)</div>
            
            <div class="analysis-box">
                <div class="analysis-title">Pandas Mastery:</div>
                After multiple merges create suffix columns, systematically renames them to meaningful business names. Shows understanding of merge mechanics and data clarity.
            </div>
        </div>

        <div class="section">
            <h2>Time Series Operations Excellence</h2>

            <div class="pattern-grid">
                <div class="pattern-card">
                    <div class="pattern-title">1. DateTime Arithmetic for Financial Calculations</div>
                    <div class="code-block">opt.loc[mask_for_dte_compute, 'dte'] = (opt['exd'] - opt.index).dt.days</div>
                    <div class="analysis-box">
                        <div class="analysis-title">Sophisticated Usage:</div>
                        <ul>
                            <li>Uses boolean masking to apply calculation only where appropriate</li>
                            <li>Leverages pandas datetime arithmetic (<span class="inline-code">dt.days</span>)</li>
                            <li>Applies vectorized calculation across entire time series</li>
                        </ul>
                    </div>
                </div>

                <div class="pattern-card">
                    <div class="pattern-title">2. Forward-Fill for Position Continuity</div>
                    <div class="code-block">opt['qty'] = opt['qty'].ffill().fillna(0)
opt = opt.ffill()  # Forward-fill all position data</div>
                    <div class="analysis-box">
                        <div class="analysis-title">Financial Domain Expertise:</div>
                        Understands that position quantities must persist until explicitly changed. The two-stage approach (first quantities, then all data) shows nuanced understanding of position lifecycle.
                    </div>
                </div>

                <div class="pattern-card">
                    <div class="pattern-title">3. Index-Based Time Filtering</div>
                    <div class="code-block">opt = opt[~opt.index.isin(list_holidays)]</div>
                    <div class="analysis-box">
                        <div class="analysis-title">Pandas Proficiency:</div>
                        Clean, vectorized approach to exclude holiday dates using boolean indexing on the index itself.
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Advanced Boolean Logic Patterns</h2>

            <h3>1. Multi-Condition Filtering</h3>
            <div class="code-block">mask_expired = opt.index > opt['exd']
opt.loc[mask_expired, expired_cols] = [pd.Timestamp(year=1985, month=12, day=31), 0.0, '-', '-']</div>
            
            <div class="analysis-box">
                <div class="analysis-title">Advanced Technique:</div>
                <ul>
                    <li>Creates boolean mask based on date comparison</li>
                    <li>Uses vectorized assignment to multiple columns simultaneously</li>
                    <li>Uses sentinel values for data integrity</li>
                </ul>
            </div>

            <h3>2. Conditional Series Manipulation</h3>
            <div class="code-block">cond_exit_series.loc[(cond_exit_series == True) & (~mask)] = False</div>
            
            <div class="analysis-box">
                <div class="analysis-title">Boolean Mastery:</div>
                Complex boolean logic combining series comparison with inverted mask. Shows deep understanding of pandas boolean operations.
            </div>
        </div>

        <div class="section">
            <h2>Data Type Management Expertise</h2>

            <div class="highlight-box">
                <h3>1. Robust Type Conversion with Error Handling</h3>
                <div class="code-block">opt['init'] = opt['init'].replace([np.inf, -np.inf], np.nan).fillna(0).astype(int)
opt['exit'] = opt['exit'].replace([np.inf, -np.inf], np.nan).fillna(0).astype(int)</div>
                
                <div class="analysis-box">
                    <div class="analysis-title">Data Quality Focus:</div>
                    <ul>
                        <li>Handles infinite values before type conversion</li>
                        <li>Uses chained operations for clean data pipeline</li>
                        <li>Ensures integer types for flag columns</li>
                    </ul>
                </div>

                <h3>2. Strategic NaN Handling</h3>
                <div class="code-block">opt.fillna(0, inplace=True)
opt['why'] = opt['why'].fillna('-')</div>
                
                <div class="analysis-box">
                    <div class="analysis-title">Domain-Aware Defaults:</div>
                    Uses different fill strategies for different column types (numeric vs categorical).
                </div>
            </div>
        </div>

        <div class="section">
            <h2>DataFrame Manipulation Patterns</h2>

            <h3>1. Index Reset/Set Pattern for Merging</h3>
            <div class="code-block">def merge_with_chain(opt, options, col, data_cols=[...]):
    opt = opt.reset_index(drop=False)
    opt = opt.merge(options[data_cols], left_on=['date',col], right_on=['date','symbol'], how='left')
    opt = opt.set_index('date', drop=True)
    return opt</div>
            
            <div class="analysis-box">
                <div class="analysis-title">Merging Best Practice:</div>
                <ul>
                    <li>Temporarily converts index to column for merge operations</li>
                    <li>Performs complex multi-column joins</li>
                    <li>Restores index structure</li>
                    <li>Cleans up redundant columns</li>
                </ul>
            </div>

            <h3>2. Duplicate Handling</h3>
            <div class="code-block">opt.drop_duplicates(subset=None, keep='first', inplace=True)</div>
            
            <div class="analysis-box">
                <div class="analysis-title">Data Integrity:</div>
                Proactive duplicate removal to maintain data quality.
            </div>
        </div>

        <div class="section">
            <h2>Aggregation and Grouping Logic</h2>

            <div class="pattern-grid">
                <div class="pattern-card">
                    <div class="pattern-title">1. Multi-DataFrame Aggregation</div>
                    <div class="code-block"># In get_total_delta_optdelta function
running_total_delta += opt['delta']
running_total_shrdelta += opt['delta'] * opt['qty'] * 100</div>
                    <div class="analysis-box">
                        <div class="analysis-title">Financial Calculation Pattern:</div>
                        Manually aggregates across related DataFrames in the dictionary, applying position-weighting calculations.
                    </div>
                </div>

                <div class="pattern-card">
                    <div class="pattern-title">2. Conditional Aggregation</div>
                    <div class="code-block">opt.loc[opt['init']==1, 'optdelta'] = running_total_new_shrdelta</div>
                    <div class="analysis-box">
                        <div class="analysis-title">Advanced Indexing:</div>
                        Uses boolean condition to apply aggregated values only to specific rows (initiation days).
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Memory-Conscious Operations</h2>

            <h3>1. Selective Column Operations</h3>
            <div class="code-block">data_cols=['date', 'symbol', 'bid', 'ask', 'mid', 'delta', 'spread', 'gamma', 'theta', 'vega']</div>
            
            <div class="analysis-box">
                <div class="analysis-title">Performance Awareness:</div>
                Explicitly specifies required columns for merges rather than using entire DataFrames.
            </div>

            <h3>2. In-Place Operations Where Appropriate</h3>
            <div class="code-block">opt.fillna(0, inplace=True)
opt.drop_duplicates(subset=None, keep='first', inplace=True)</div>
            
            <div class="analysis-box">
                <div class="analysis-title">Memory Efficiency:</div>
                Uses in-place operations for transformations that don't need to preserve original data.
            </div>
        </div>

        <div class="section">
            <h2>Complex Series Operations</h2>

            <div class="highlight-box">
                <h3>1. Chained Boolean Logic</h3>
                <div class="code-block">mask = mask.fillna(False)
cond_exit_series.loc[(cond_exit_series == True) & (~mask)] = False</div>
                
                <div class="analysis-box">
                    <div class="analysis-title">Series Mastery:</div>
                    <ul>
                        <li>Handles NaN values in boolean masks</li>
                        <li>Applies complex conditional logic to Series</li>
                        <li>Maintains data integrity throughout transformations</li>
                    </ul>
                </div>

                <h3>2. Sentinel Value Strategy</h3>
                <div class="code-block">opt['exd'] = opt['exd'].fillna(pd.Timestamp(year=1985, month=12, day=31))</div>
                
                <div class="analysis-box">
                    <div class="analysis-title">Data Management:</div>
                    Uses far-past dates as sentinel values for missing expiration dates, enabling consistent date arithmetic operations.
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Summary of Pandas Excellence</h2>

            <p>This framework demonstrates <strong>master-level pandas usage</strong> through:</p>

            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-number">1</div>
                    <strong>Sophisticated multi-DataFrame coordination</strong> with shared time indices
                </div>
                <div class="summary-item">
                    <div class="summary-number">2</div>
                    <strong>Advanced merging strategies</strong> handling temporal relationships
                </div>
                <div class="summary-item">
                    <div class="summary-number">3</div>
                    <strong>Complex boolean indexing</strong> for financial position logic
                </div>
                <div class="summary-item">
                    <div class="summary-number">4</div>
                    <strong>Robust data type management</strong> with error handling
                </div>
                <div class="summary-item">
                    <div class="summary-number">5</div>
                    <strong>Strategic use of forward-fill</strong> for position continuity
                </div>
                <div class="summary-item">
                    <div class="summary-number">6</div>
                    <strong>DateTime arithmetic</strong> for financial calculations
                </div>
                <div class="summary-item">
                    <div class="summary-number">7</div>
                    <strong>Memory-conscious operations</strong> with selective column usage
                </div>
                <div class="summary-item">
                    <div class="summary-number">8</div>
                    <strong>Clean data pipeline patterns</strong> with method chaining
                </div>
            </div>

            <div class="highlight-box">
                <p>The code shows someone who deeply understands both pandas mechanics and financial domain requirements, creating a robust system that handles the complexities of multi-instrument position tracking over time.</p>
            </div>
        </div>
    </div>
</body>
</html>
