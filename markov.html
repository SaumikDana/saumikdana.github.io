<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gambler's Ruin & Expected Steps — Interactive Notes</title>
<link rel="stylesheet" href="styles.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=EB+Garamond&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
  :root{
    --bg:#0b0e13; --card:#121826; --ink:#eaf0ff; --muted:#9db0d3;
    --accent:#7aa2ff; --accent2:#12d1c1; --danger:#ff6b6b;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.55 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;}
  a{color:var(--accent)}
  .wrap{max-width:980px;margin:0 auto;padding:28px 18px 80px}
  h1,h2,h3{line-height:1.2;margin:24px 0 10px}
  h1{font-size:clamp(28px,4vw,40px);letter-spacing:.2px}
  h2{font-size:clamp(22px,3vw,28px)}
  h3{font-size:clamp(18px,2.6vw,22px)}
  p{margin:12px 0}
  .card{background:var(--card);border:1px solid rgba(255,255,255,.07);
        border-radius:14px;padding:18px 18px;box-shadow:0 6px 24px rgba(0,0,0,.25); margin:16px 0}
  .muted{color:var(--muted)}
  .grid{display:grid;gap:16px}
  @media (min-width:880px){ .grid.two{grid-template-columns:1fr 1fr} }
  code,pre{background:#0f1420;border:1px solid rgba(255,255,255,.09);color:#d5e2ff}
  pre{padding:14px;border-radius:10px;overflow:auto}
  .tag{display:inline-block;font-size:12px;padding:4px 8px;border:1px solid rgba(255,255,255,.1);border-radius:999px;margin-right:6px;color:var(--muted)}
  .pill{display:inline-flex;align-items:center;gap:8px;border-radius:999px;padding:6px 12px;background:linear-gradient(90deg, rgba(122,162,255,.15), rgba(18,209,193,.15));border:1px solid rgba(122,162,255,.35)}
  .kbd{display:inline-block;border:1px solid rgba(255,255,255,.2);border-bottom-width:3px;border-radius:6px;padding:2px 6px;font-weight:700}
  .hr{height:1px;background:linear-gradient(90deg, transparent, rgba(255,255,255,.15), transparent); margin:24px 0}
  .btn{cursor:pointer; background:linear-gradient(90deg,var(--accent),var(--accent2));
       color:#061122;border:none;border-radius:12px;padding:10px 14px;font-weight:700;box-shadow:0 8px 18px rgba(18,209,193,.25)}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  label{font-size:13px;color:var(--muted)}
  input[type="number"], input[type="text"], select{
    background:#0f1420;color:var(--ink);border:1px solid rgba(255,255,255,.15);
    padding:8px 10px;border-radius:10px;min-width:90px
  }
  canvas{border-radius:12px;background:#0f1420;border:1px solid rgba(255,255,255,.08)}
  details{border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:10px 12px}
  details[open]{background:#0f1420}
  summary{cursor:pointer;color:var(--muted);font-weight:600}
  .warn{color:var(--danger);font-weight:700}
</style>

<!-- MathJax for LaTeX rendering -->
<script>
window.MathJax = {
  tex: {inlineMath: [['\\(','\\)'],['$','$']], displayMath: [['\\[','\\]']]},
  svg: {fontCache: 'global'}
};
</script>
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
<div class="wrap">
  <h1>Gambler’s Ruin & Expected Steps — with Interactive Tools</h1>
  <p class="muted">Everything below matches your write-up, but now it’s web-friendly and interactive. Equations render via MathJax; you can also compute and simulate.</p>

  <div class="card">
    <h2>Gambler's Ruin Problem</h2>
    <p>The Gambler's Ruin problem is a classic problem in probability theory that can be seen as an example of a random walk.</p>
    <p>In this problem, a gambler starts with a certain bankroll \((N)\) and plays a game with a certain probability of winning \((p)\). The gambler's ruin is the event that the gambler eventually loses all of their money.</p>
    <p>The probability of the gambler's ruin, given they start with \(i\) dollars, can be found by solving a difference equation, which leads to the formula:</p>
    <div class="card">
      \[
      P(\text{ruin}\mid i) =
      \begin{cases}
      \dfrac{(q/p)^i - (q/p)^N}{1 - (q/p)^N}, & p \neq 0.5, \\
      1 - \dfrac{i}{N}, & p = 0.5
      \end{cases}
      \]
      where \(q = 1-p\).
    </div>

    <h3>Derivation (sketch)</h3>
    <p>Let \(P_i\) be the probability of ruin when starting with \(i\) dollars. Condition on the first step:</p>
    <div class="card">
      \[
      P_i = p\,P_{i+1} + q\,P_{i-1}, \qquad P_0=1,\;P_N=0.
      \]
      \[
      p\,P_{i+1} - P_i + q\,P_{i-1}=0
      \xRightarrow{\;P_i=\lambda^i\;} p\lambda^2-\lambda+q=0
      \]
      Roots: \(\lambda_1=1,\,\lambda_2=q/p\). Solve constants via the boundaries to get the stated formulas;
      the \(p=0.5\) case uses a repeated root and yields \(P_i=1-\tfrac{i}{N}\).
    </div>
  </div>

  <div class="card">
    <h2>General Master Equation (Single Framework)</h2>
    <p>Most variants are obtained by changing only the <em>coefficients</em> \(p(i)\), the <em>jump size</em> \(\Delta_i\), and/or the <em>boundary conditions</em>.</p>
    <div class="card">
      \[
      (\mathcal{L}f)(i) = p(i)\big[f(i+\Delta_i)-f(i)\big] + q(i)\big[f(i-\Delta_i)-f(i)\big],\quad q(i)=1-p(i).
      \]
    </div>
    <p>Here \(f\) is the quantity of interest:</p>
    <ul>
      <li>\(f(i)=P(i)\): ruin (hitting) probability, \(\;\mathcal{L}P=0\) with Dirichlet boundaries.</li>
      <li>\(f(i)=T(i)\): expected time to absorption, \(\;\mathcal{L}T=-1\) with \(T\) fixed on absorbing states.</li>
    </ul>
    <div class="grid two">
      <div class="card">
        <span class="tag">Ruin probability</span>
        \[
          \mathcal{L}P(i)=0,\qquad P(0)=1,\;P(N)=0.
        \]
      </div>
      <div class="card">
        <span class="tag">Expected time</span>
        \[
          \mathcal{L}T(i)=-1,\qquad T(0)=T(N)=0.
        \]
      </div>
    </div>
  </div>

  <div class="card">
    <h2>Seven Essential Variants and How They Modify the Master Equation</h2>
    <p class="muted">Flags show what changes: <span class="tag">coefficients</span> \(p(i)\), <span class="tag">jump size</span> \(\Delta_i\), <span class="tag">boundaries</span>.</p>

    <details open><summary><strong>1. Classic Fair</strong> — <span class="tag">coefficients</span> <span class="tag">boundaries</span></summary>
      <p><strong>Problem:</strong> Unit stake, \(p=0.5\). <strong>Result:</strong> \(P_i=1-\frac{i}{N}\), \(T_i=i(N-i)\).</p>
    </details>

    <details><summary><strong>2. Unfair (Casino Edge)</strong> — <span class="tag">coefficients</span> <span class="tag">boundaries</span></summary>
      <p><strong>Problem:</strong> \(p<0.5\). <strong>Result:</strong> \(P_i=\frac{r^i-r^N}{1-r^N}\), \(r=\frac{q}{p}>1\).
      \(\;T_i = \frac{i}{q-p}-\frac{N}{q-p}\cdot\frac{1-r^i}{1-r^N}\).</p>
    </details>

    <details><summary><strong>3. Martingale Strategy</strong> — <span class="tag">coefficients</span> <span class="tag">jump size</span> <span class="tag">boundaries</span></summary>
      <p>Ruin probability same as constant stake with same \(p\); variance/time differ.</p>
    </details>

    <details><summary><strong>4. Bold Play</strong> — <span class="tag">coefficients</span> <span class="tag">jump size</span> <span class="tag">boundaries</span></summary>
      <p>\(\Delta_i=\min(i,N-i)\). For \(p>0.5\) maximizes success; for \(p<0.5\) minimizes time to ruin.</p>
    </details>

    <details><summary><strong>5. Parrondo’s Paradox</strong> — <span class="tag">coefficients</span> <span class="tag">boundaries</span></summary>
      <p>Alternating two losing games can yield \(p_{\mathrm{eff}}>0.5\).</p>
    </details>

    <details><summary><strong>6. Stock Price Model</strong> — <span class="tag">coefficients</span> <span class="tag">boundaries</span></summary>
      <p>Diffusion limit: \(\mathcal{L}f=\mu f'(x)+\tfrac12\sigma^2 f''(x)\). Barrier-hitting probability matches diffusion formula.</p>
    </details>

    <details><summary><strong>7. Population Genetics</strong> — <span class="tag">coefficients</span> <span class="tag">boundaries</span></summary>
      <p>Neutral: fixation = \(i/N\). With selection, biased-ruin formula applies with \(p(i)\) from selection.</p>
    </details>
  </div>

  <div class="card">
    <h2>Expected Steps to Hit \(+k\) from \(0\): Two Standard Cases</h2>
    <p class="pill">Same master operator, but now we solve \(\mathcal{L}T=-1\) (Poisson equation).</p>

    <div class="grid two">
      <div class="card">
        <h3>Case A — One-sided (semi-infinite)</h3>
        <p><strong>Problem:</strong> Start at \(0\); stop when first hitting \(+k\); no left boundary.</p>
        <p><strong>Result (requires \(p>0.5\)): </strong> \(\;\displaystyle T(0)=\frac{k}{p-q}\), else \(T(0)=\infty\).</p>
        <details><summary>Derivation (click)</summary>
          <p>Solve \(pT(i+1)-T(i)+qT(i-1)=-1\). Homogeneous roots \(1,r=q/p\). Particular \(T_p=-\frac{i}{p-q}\).
          Boundedness as \(i\to-\infty\) forces the \(r^i\) term out; impose \(T(k)=0\) to get \(T(i)=\frac{k-i}{p-q}\).</p>
        </details>
      </div>

      <div class="card">
        <h3>Case B — Two-sided (finite interval)</h3>
        <p><strong>Problem:</strong> Start at \(0\); stop on hitting \(\{-k,+k\}\).</p>
        <p><strong>Result:</strong>
        \[
        T(0)=
        \begin{cases}
          k^2,& p=\tfrac12,\\[6pt]
          \dfrac{k}{\,q-p\,}\,\dfrac{r^{\,k}-1}{\,r^{\,k}+1\,},& p\neq\tfrac12,\; r=\tfrac{q}{p}.
        \end{cases}
        \]</p>
      </div>
    </div>

    <div class="hr"></div>

    <h3>Quick Calculator</h3>
    <div class="grid two">
      <div class="card">
        <h4>Case A (one-sided)</h4>
        <div class="row">
          <label>k <input type="number" id="kA" value="10" min="1" step="1"></label>
          <label>p <input type="number" id="pA" value="0.6" min="0" max="1" step="0.01"></label>
          <button class="btn" id="calcA">Compute</button>
        </div>
        <p id="outA" class="muted">Result appears here.</p>
      </div>

      <div class="card">
        <h4>Case B (two-sided)</h4>
        <div class="row">
          <label>k <input type="number" id="kB" value="10" min="1" step="1"></label>
          <label>p <input type="number" id="pB" value="0.5" min="0" max="1" step="0.01"></label>
          <button class="btn" id="calcB">Compute</button>
        </div>
        <p id="outB" class="muted">Result appears here.</p>
      </div>
    </div>

    <div class="hr"></div>

    <h3>Mini Simulator (visual intuition)</h3>
    <p class="muted">Simulates a single walk starting at 0 until it hits the boundary shown. Use it to “feel” drift vs. no drift.</p>
    <div class="grid two">
      <div class="card">
        <h4>Case A: hit \(+k\) (no left boundary)</h4>
        <div class="row">
          <label>k <input type="number" id="simkA" value="25" min="1" step="1"></label>
          <label>p <input type="number" id="simpA" value="0.6" min="0" max="1" step="0.01"></label>
          <button class="btn" id="runA">Run</button>
        </div>
        <p id="simAmsg" class="muted"></p>
        <canvas id="canvasA" width="450" height="160"></canvas>
      </div>

      <div class="card">
        <h4>Case B: hit \(\{-k,+k\}\)</h4>
        <div class="row">
          <label>k <input type="number" id="simkB" value="25" min="1" step="1"></label>
          <label>p <input type="number" id="simpB" value="0.5" min="0" max="1" step="0.01"></label>
          <button class="btn" id="runB">Run</button>
        </div>
        <p id="simBmsg" class="muted"></p>
        <canvas id="canvasB" width="450" height="160"></canvas>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>Copy-paste LaTeX (for reference)</h2>
    <p class="muted">Exact LaTeX for your write-up (already reflected above).</p>
    <details>
      <summary>Show LaTeX</summary>
      <pre><code>% Your LaTeX content is the same as in the conversation; paste from your document if needed.</code></pre>
    </details>
  </div>

  <p class="muted">Tip: Press <span class="kbd">Cmd</span>/<span class="kbd">Ctrl</span> + <span class="kbd">L</span> to highlight the URL and copy this page link for your notes.</p>
</div>

<script>
/* ---------- Calculators ---------- */
function fmt(x){ return (Math.abs(x) > 1e5 || Math.abs(x) < 1e-4) ? x.toExponential(6) : x.toFixed(6); }

document.getElementById('calcA').addEventListener('click', () => {
  const k = Math.max(1, Math.floor(Number(document.getElementById('kA').value)));
  const p = Number(document.getElementById('pA').value);
  const q = 1 - p;
  const out = document.getElementById('outA');
  if (!(p > 0 && p < 1)){ out.innerHTML = '<span class="warn">Enter 0 &lt; p &lt; 1.</span>'; return; }
  if (p <= 0.5){ out.innerHTML = 'No rightward drift ⇒ expected time is <strong>infinite</strong> (without a left boundary).'; return; }
  const T = k / (p - q);
  out.innerHTML = `T(0) = k / (p - q) = <strong>${fmt(T)}</strong>`;
});

document.getElementById('calcB').addEventListener('click', () => {
  const k = Math.max(1, Math.floor(Number(document.getElementById('kB').value)));
  const p = Number(document.getElementById('pB').value);
  const q = 1 - p, r = q / p;
  const out = document.getElementById('outB');
  if (!(p > 0 && p < 1)){ out.innerHTML = '<span class="warn">Enter 0 &lt; p &lt; 1.</span>'; return; }
  if (Math.abs(p - 0.5) < 1e-12){
    out.innerHTML = `T(0) = k² = <strong>${k*k}</strong>`;
    return;
  }
  const T = (k / (q - p)) * ((Math.pow(r, k) - 1) / (Math.pow(r, k) + 1));
  out.innerHTML = `T(0) = (k/(q-p)) * ((r^k - 1)/(r^k + 1)) = <strong>${fmt(T)}</strong> <span class="muted">(r = q/p)</span>`;
});

/* ---------- Mini simulators ---------- */
function drawAxes(ctx, width, height, kLeft, kRight, x0, scaleX) {
  ctx.clearRect(0,0,width,height);
  ctx.strokeStyle = 'rgba(255,255,255,.15)';
  ctx.lineWidth = 1;
  // midline
  ctx.beginPath(); ctx.moveTo(0, height/2); ctx.lineTo(width, height/2); ctx.stroke();
  // marks
  ctx.fillStyle = 'rgba(255,255,255,.45)';
  ctx.fillText('0', x0, height/2 - 6);
  ctx.fillStyle = 'rgba(122,162,255,.9)';
  ctx.fillRect(x0 + kRight*scaleX - 1, 4, 2, height-8);
  ctx.fillStyle = 'rgba(18,209,193,.9)';
  ctx.fillRect(x0 + kLeft*scaleX - 1, 4, 2, height-8);
}

function simulateToRight(k, p, maxSteps=20000){
  let pos=0, steps=0;
  while (pos<k && steps<maxSteps){
    const u = Math.random();
    pos += (u<p ? +1 : -1);
    steps++;
    if (pos < -1e6) break; // safety
  }
  return {steps, hit: pos>=k};
}

function simulateTwoSided(k, p, maxSteps=20000){
  let pos=0, steps=0, hitRight=false, hitLeft=false;
  while (pos<k && pos>-k && steps<maxSteps){
    const u = Math.random();
    pos += (u<p ? +1 : -1);
    steps++;
  }
  if (pos>=k) hitRight=true;
  if (pos<=-k) hitLeft=true;
  return {steps, hitRight, hitLeft};
}

function animateWalk(canvas, kRight, kLeft, p, twoSided=false){
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  const scaleX = Math.max(2, Math.floor(W / (2*Math.max(kRight, kLeft||kRight) + 6)));
  const x0 = Math.floor(W/2);
  drawAxes(ctx,W,H,-(kLeft||0),kRight,x0,scaleX);

  let pos = 0, t = 0;
  ctx.strokeStyle = 'rgba(255,255,255,.85)'; ctx.lineWidth = 2;
  ctx.beginPath(); ctx.moveTo(x0, H/2);
  const id = setInterval(() => {
    const u = Math.random();
    pos += (u < p ? +1 : -1);
    t++;
    const x = x0 + pos*scaleX, y = H/2 + (Math.sin(t/5)*8);
    ctx.lineTo(x,y); ctx.stroke();

    const stopA = (!twoSided && pos>=kRight) || (!twoSided && Math.abs(pos)>1e5);
    const stopB = (twoSided && (pos>=kRight || pos<=-kLeft));
    if (stopA || stopB || t>5000){ clearInterval(id); }
  }, 16);
}

/* Hook up Case A sim */
document.getElementById('runA').addEventListener('click', () => {
  const k = Math.max(1, Math.floor(Number(document.getElementById('simkA').value)));
  const p = Number(document.getElementById('simpA').value); const q = 1-p;
  const canvas = document.getElementById('canvasA');
  const msg = document.getElementById('simAmsg');
  if (!(p>0 && p<1)){ msg.textContent = 'Enter 0 < p < 1.'; return; }
  if (p<=0.5){ msg.innerHTML = 'No rightward drift ⇒ expected time is <strong>infinite</strong>; sim may take long.'; }
  else { msg.innerHTML = `Expected T(0) ≈ k/(p-q) = <strong>${fmt(k/(p-q))}</strong>`; }
  animateWalk(canvas, k, null, p, false);
});

/* Hook up Case B sim */
document.getElementById('runB').addEventListener('click', () => {
  const k = Math.max(1, Math.floor(Number(document.getElementById('simkB').value)));
  const p = Number(document.getElementById('simpB').value);
  const canvas = document.getElementById('canvasB');
  const msg = document.getElementById('simBmsg');
  if (!(p>0 && p<1)){ msg.textContent = 'Enter 0 < p < 1.'; return; }
  const q = 1-p, r = q/p;
  if (Math.abs(p-0.5)<1e-12) msg.innerHTML = `Expected T(0) = k² = <strong>${k*k}</strong>`;
  else msg.innerHTML = `Expected T(0) = (k/(q-p)) * ((r^k - 1)/(r^k + 1)) = <strong>${fmt((k/(q-p))*((Math.pow(r,k)-1)/(Math.pow(r,k)+1)))}</strong>`;
  animateWalk(canvas, k, k, p, true);
});
</script>
</body>
</html>
