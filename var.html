<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Optimization Framework - Four Formulations</title>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true,
                tags: 'ams'
            },
            options: {
                ignoreHtmlClass: "tex2jax_ignore",
                processHtmlClass: "tex2jax_process"
            },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    console.log('MathJax is loaded and ready!');
                }
            }
        };
    </script>
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.7;
            color: #2c3e50;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 300;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        h2 {
            color: #34495e;
            border-left: 5px solid #667eea;
            padding-left: 15px;
            margin-top: 35px;
            margin-bottom: 20px;
            font-size: 1.6em;
            font-weight: 400;
        }
        
        h3 {
            color: #34495e;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 500;
        }
        
        h4 {
            color: #34495e;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1em;
            font-weight: 600;
        }
        
        .math-block {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-left: 4px solid #667eea;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow-x: auto;
        }
        
        .formulation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .formulation-card {
            background: linear-gradient(135deg, #fff, #f8fafc);
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
        }
        
        .formulation-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .formulation-card.original {
            border-color: #dc2626;
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
        }
        
        .formulation-card.option1 {
            border-color: #2563eb;
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
        }
        
        .formulation-card.option2 {
            border-color: #059669;
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
        }
        
        .formulation-card.option3 {
            border-color: #7c3aed;
            background: linear-gradient(135deg, #f3e8ff, #e9d5ff);
        }
        
        .formulation-card h4 {
            margin-top: 0;
            display: flex;
            align-items: center;
            font-size: 1.2em;
        }
        
        .formulation-card.original h4 {
            color: #dc2626;
        }
        
        .formulation-card.option1 h4 {
            color: #2563eb;
        }
        
        .formulation-card.option2 h4 {
            color: #059669;
        }
        
        .formulation-card.option3 h4 {
            color: #7c3aed;
        }
        
        .formulation-card h4::before {
            margin-right: 8px;
            font-size: 1.2em;
        }
        
        .formulation-card.original h4::before {
            content: "üèõÔ∏è";
        }
        
        .formulation-card.option1 h4::before {
            content: "‚öñÔ∏è";
        }
        
        .formulation-card.option2 h4::before {
            content: "üéØ";
        }
        
        .formulation-card.option3 h4::before {
            content: "üîß";
        }
        
        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .pros {
            background: rgba(34, 197, 94, 0.1);
            border-left: 3px solid #22c55e;
            padding: 10px;
            border-radius: 6px;
        }
        
        .cons {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid #ef4444;
            padding: 10px;
            border-radius: 6px;
        }
        
        .pros h5, .cons h5 {
            margin: 0 0 8px 0;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .pros h5 {
            color: #059669;
        }
        
        .cons h5 {
            color: #dc2626;
        }
        
        .pros ul, .cons ul {
            margin: 0;
            padding-left: 15px;
            font-size: 0.85em;
        }
        
        .architecture-section {
            background: linear-gradient(135deg, #fef7cd, #fef3c7);
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .architecture-section h3 {
            color: #92400e;
            margin-top: 0;
            display: flex;
            align-items: center;
        }
        
        .architecture-section h3::before {
            content: "üèóÔ∏è";
            margin-right: 10px;
            font-size: 1.2em;
        }
        
        .code-flow {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            border: 2px solid #64748b;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .flow-step {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 8px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .flow-step::before {
            content: "‚Üí";
            margin-right: 10px;
            color: #667eea;
            font-weight: bold;
        }
        
        .comparison-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin: 20px 0;
        }
        
        .comparison-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .comparison-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
            vertical-align: top;
        }
        
        .comparison-table tr:nth-child(even) {
            background: #f8fafc;
        }
        
        .highlight {
            background: linear-gradient(120deg, #a78bfa 0%, #f472b6 100%);
            color: white;
            padding: 3px 8px;
            border-radius: 6px;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        
        .variable {
            font-family: 'Courier New', monospace;
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            color: #475569;
            border: 1px solid #cbd5e1;
        }
        
        .note {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            border: 1px solid #60a5fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
        }
        
        .note::before {
            content: "‚ÑπÔ∏è";
            position: absolute;
            top: -8px;
            left: 15px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .note p {
            margin: 0;
            color: #1e40af;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
                border-radius: 15px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .formulation-grid {
                grid-template-columns: 1fr;
            }
            
            .pros-cons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Portfolio Optimization Framework</h1>
        <p style="text-align: center; font-size: 1.1em; color: #64748b; margin-bottom: 40px;">
            <strong>Four Mathematical Formulations</strong> - From Traditional Sharpe to Modern Risk-Adjusted Approaches
        </p>

        <h2>Problem Overview</h2>
        
        <p>Portfolio optimization seeks to find the <strong>optimal allocation of capital</strong> across different assets or strategies. We present four different mathematical formulations, each with distinct advantages and use cases.</p>

        <div class="note">
            <p><strong>Common Elements Across All Formulations:</strong><br>
            <span class="variable">w</span> = [w‚ÇÅ, w‚ÇÇ, ..., w‚Çô]·µÄ (portfolio weights vector)<br>
            <span class="variable">Œº</span> = [Œº‚ÇÅ, Œº‚ÇÇ, ..., Œº‚Çô]·µÄ (expected returns vector)<br>
            <span class="variable">Œ£</span> = covariance matrix<br>
            <span class="variable">v</span> = [VaR‚ÇÅ, VaR‚ÇÇ, ..., VaR‚Çô]·µÄ (VaR estimates vector)
            </p>
        </div>

        <h2>Four Optimization Formulations</h2>

        <div class="formulation-grid" style="grid-template-columns: 1fr 1fr; margin-bottom: 30px;">
            <div class="formulation-card original">
                <h4>Original: Sharpe with VaR Constraint</h4>
                <div class="math-block">
                    $\begin{align}
                    \text{minimize} \quad & -\frac{\boldsymbol{\mu}^T\mathbf{w}}{\sqrt{\mathbf{w}^T\boldsymbol{\Sigma}\mathbf{w}}} \\
                    \text{subject to:} \quad & \mathbf{1}^T\mathbf{w} = 1 \\
                    & \text{VaR}_{\max} - \mathbf{v}^T\mathbf{w} \geq 0 \\
                    & 0 \leq w_i \leq w_{\max}
                    \end{align}$
                </div>
                <div class="pros-cons">
                    <div class="pros">
                        <h5>‚úÖ Pros</h5>
                        <ul>
                            <li>Traditional Sharpe optimization</li>
                            <li>Well-understood theory</li>
                            <li>Regulatory compliance</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <h5>‚ùå Cons</h5>
                        <ul>
                            <li>Non-convex optimization</li>
                            <li>Local minima issues</li>
                            <li>Requires VaR limit</li>
                            <li>Slow convergence</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="formulation-card option1">
                <h4>Option 1: Weighted Combination</h4>
                <div class="math-block">
                    $\begin{align}
                    \text{minimize} \quad & -\alpha \cdot \frac{\boldsymbol{\mu}^T\mathbf{w}}{\sqrt{\mathbf{w}^T\boldsymbol{\Sigma}\mathbf{w}}} + \beta \cdot \mathbf{v}^T\mathbf{w} \\
                    \text{subject to:} \quad & \mathbf{1}^T\mathbf{w} = 1 \\
                    & 0 \leq w_i \leq w_{\max}
                    \end{align}$
                </div>
                <p><strong>Parameters:</strong> Œ± (Sharpe weight), Œ≤ (VaR penalty)</p>
                <div class="pros-cons">
                    <div class="pros">
                        <h5>‚úÖ Pros</h5>
                        <ul>
                            <li>Flexible objective weighting</li>
                            <li>No VaR constraint needed</li>
                            <li>Balances return and risk</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <h5>‚ùå Cons</h5>
                        <ul>
                            <li>Still non-convex</li>
                            <li>Two parameters to tune</li>
                            <li>Parameter scaling issues</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="formulation-grid" style="grid-template-columns: 1fr 1fr;">
            <div class="formulation-card option2">
                <h4>Option 2: Sharpe with VaR Penalty</h4>
                <div class="math-block">
                    $\begin{align}
                    \text{minimize} \quad & -\frac{\boldsymbol{\mu}^T\mathbf{w}}{\sqrt{\mathbf{w}^T\boldsymbol{\Sigma}\mathbf{w}}} + \lambda \cdot \mathbf{v}^T\mathbf{w} \\
                    \text{subject to:} \quad & \mathbf{1}^T\mathbf{w} = 1 \\
                    & 0 \leq w_i \leq w_{\max}
                    \end{align}$
                </div>
                <p><strong>Parameter:</strong> Œª (risk aversion/VaR penalty)</p>
                <div class="pros-cons">
                    <div class="pros">
                        <h5>‚úÖ Pros</h5>
                        <ul>
                            <li>Intuitive Sharpe + penalty</li>
                            <li>Single parameter</li>
                            <li>No VaR constraint</li>
                            <li>Economic interpretation</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <h5>‚ùå Cons</h5>
                        <ul>
                            <li>Non-convex optimization</li>
                            <li>Local minima possible</li>
                            <li>Moderate complexity</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="formulation-card option3">
                <h4>Option 3: VaR-Adjusted Sharpe</h4>
                <div class="math-block">
                    $\begin{align}
                    \text{minimize} \quad & -\frac{\boldsymbol{\mu}^T\mathbf{w}}{\sqrt{\mathbf{w}^T\boldsymbol{\Sigma}\mathbf{w}} + \lambda \cdot \mathbf{v}^T\mathbf{w}} \\
                    \text{subject to:} \quad & \mathbf{1}^T\mathbf{w} = 1 \\
                    & 0 \leq w_i \leq w_{\max}
                    \end{align}$
                </div>
                <p><strong>Parameter:</strong> Œª (VaR adjustment factor)</p>
                <div class="pros-cons">
                    <div class="pros">
                        <h5>‚úÖ Pros</h5>
                        <ul>
                            <li>Modified Sharpe ratio</li>
                            <li>VaR in denominator</li>
                            <li>Novel risk measure</li>
                            <li>Single parameter</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <h5>‚ùå Cons</h5>
                        <ul>
                            <li>Non-convex optimization</li>
                            <li>Less intuitive</li>
                            <li>Experimental approach</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <h2>Implementation Architecture</h2>

        <div class="architecture-section">
            <h3>Modular Design Pattern</h3>
            <p>The implementation follows a clean, modular architecture that separates concerns and eliminates code duplication:</p>
            
            <div class="code-flow">
                <div class="flow-step">optimizer(method='original'|'option1'|'option2'|'option3')</div>
                <div class="flow-step">initialize_solver() ‚Üí returns (bounds, x0, options)</div>
                <div class="flow-step">method_function() ‚Üí returns (objective_fn, constraints)</div>
                <div class="flow-step">minimize(objective_fn, x0, constraints, bounds, options)</div>
                <div class="flow-step">return optimal_weights</div>
            </div>

            <h4>Key Architecture Benefits:</h4>
            <ul>
                <li><strong>Single Entry Point:</strong> One <span class="variable">optimizer()</span> function handles all formulations</li>
                <li><strong>No Code Duplication:</strong> Common setup code extracted to <span class="variable">initialize_solver()</span></li>
                <li><strong>Clean Separation:</strong> Each formulation isolated in its own function</li>
                <li><strong>Easy Extension:</strong> Adding new formulations requires only one new function</li>
                <li><strong>Consistent Interface:</strong> All methods use the same parameter structure</li>
            </ul>
        </div>

        <h2>Comparative Analysis</h2>

        <div class="comparison-table">
            <table>
                <thead>
                    <tr>
                        <th>Aspect</th>
                        <th>Original</th>
                        <th>Option 1</th>
                        <th>Option 2</th>
                        <th>Option 3</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Optimization Type</strong></td>
                        <td>Non-convex QCQP</td>
                        <td>Non-convex</td>
                        <td>Non-convex</td>
                        <td>Non-convex</td>
                    </tr>
                    <tr>
                        <td><strong>Constraints</strong></td>
                        <td>Budget + VaR + Weight</td>
                        <td>Budget + Weight</td>
                        <td>Budget + Weight</td>
                        <td>Budget + Weight</td>
                    </tr>
                    <tr>
                        <td><strong>Parameters</strong></td>
                        <td>VaR_max</td>
                        <td>Œ±, Œ≤</td>
                        <td>Œª</td>
                        <td>Œª</td>
                    </tr>
                    <tr>
                        <td><strong>Complexity</strong></td>
                        <td>High</td>
                        <td>High</td>
                        <td>Medium</td>
                        <td>Medium</td>
                    </tr>
                    <tr>
                        <td><strong>Interpretability</strong></td>
                        <td>Traditional</td>
                        <td>Flexible</td>
                        <td>Intuitive</td>
                        <td>Novel</td>
                    </tr>
                    <tr>
                        <td><strong>Best Use Case</strong></td>
                        <td>Regulatory compliance</td>
                        <td>Custom risk-return balance</td>
                        <td>General purpose</td>
                        <td>Research/experimental</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2>Mathematical Properties</h2>

        <h3>Common Constraints</h3>
        <p>All formulations share these constraints:</p>
        <div class="math-block">
            $$\begin{align}
            \text{Budget:} \quad & \sum_{i=1}^{n} w_i = 1 \\
            \text{Long-only:} \quad & w_i \geq 0 \quad \forall i \\
            \text{Concentration:} \quad & w_i \leq w_{\max} \quad \forall i
            \end{align}$$
        </div>

        <h3>Risk Model</h3>
        <p>All formulations use <strong>linear VaR aggregation</strong>:</p>
        <div class="math-block">
            $$\text{Portfolio VaR} \approx \sum_{i=1}^{n} w_i \cdot \text{VaR}_i = \mathbf{v}^T\mathbf{w}$$
        </div>

        <div class="note">
            <p><strong>Implementation Note:</strong> The modular architecture allows easy switching between formulations for testing and comparison. Each method can be benchmarked against the others using the same input data to determine the best approach for specific use cases.</p>
        </div>

        <h2>Selection Guidelines</h2>

        <div class="formulation-grid">
            <div class="formulation-card">
                <h4>üéØ Choose Original If:</h4>
                <ul>
                    <li>You need traditional Sharpe ratio optimization</li>
                    <li>Regulatory requirements specify VaR limits</li>
                    <li>Small portfolio (&lt;50 assets)</li>
                    <li>Performance speed isn't critical</li>
                </ul>
            </div>

            <div class="formulation-card">
                <h4>‚öñÔ∏è Choose Option 1 If:</h4>
                <ul>
                    <li>You want explicit control over Sharpe vs VaR weighting</li>
                    <li>Different market regimes require different balances</li>
                    <li>You have time to tune two parameters</li>
                    <li>Maximum flexibility is needed</li>
                </ul>
            </div>

            <div class="formulation-card">
                <h4>üöÄ Choose Option 2 If:</h4>
                <ul>
                    <li>You want Sharpe-based optimization with VaR control</li>
                    <li>Single parameter tuning is preferred</li>
                    <li>General-purpose optimization is needed</li>
                    <li>Good balance of theory and practicality</li>
                </ul>
            </div>

            <div class="formulation-card">
                <h4>üî¨ Choose Option 3 If:</h4>
                <ul>
                    <li>You're researching novel risk measures</li>
                    <li>VaR should directly impact risk measurement</li>
                    <li>Experimental approaches are acceptable</li>
                    <li>You want to modify the Sharpe ratio concept</li>
                </ul>
            </div>
        </div>

        <div class="note">
            <p><strong>Recommendation:</strong> Start with <span class="highlight">Option 2 (Sharpe with VaR Penalty)</span> for most practical applications. It provides the best balance of theoretical soundness, interpretability, and implementation simplicity while eliminating the need for arbitrary VaR constraints.</p>
        </div>
    </div>
</body>
</html>
